{% load static %}
<html>
  <head>
    <title>QR</title>
  </head>
  <body>
    <!-- TODO -->
    <div style="width: 600px" id="reader"></div>
    <script src="{% static 'bike_map/script.js' %}"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script>

async function onScanSuccess(decodedText, decodedResult) {
    const link = "{% url 'get-bike-code' %}";
    const url = new URL(link, window.location.origin); 
    url.search = new URLSearchParams({ "qr_code": decodedText });
    const response = await fetch(url);
    const data = await response.json();
    window.location.href = "{% url 'map-home' %}"
    alert(`Yours code is: ${data.bike_code}`); 
}
function onScanError(errorMessage) {
  // handle on error condition, with error message
}
    var html5QrcodeScanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250,videoConstraints: {facingMode: { exact: "environment" },} });
    html5QrcodeScanner.render(onScanSuccess, onScanError);


    
    </script>
  </body>
</html>
